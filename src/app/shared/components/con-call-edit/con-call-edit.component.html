<mat-card class="con-call-edit-wrapper mat-elevation-z4" *ngIf="call; else create">
  <mat-card-title class="cfd-title">Call for data</mat-card-title>

  <mat-card-content>
    <form [formGroup]="generalForm" (ngSubmit)="submitForm()" class="form">
      <div class="block-title w-100">Basic Information</div>
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Title</mat-label>
        <input matInput formControlName="title">
      </mat-form-field>

      <mat-form-field appearance="fill"  class="w-100">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description"></textarea>
      </mat-form-field>

      <mat-form-field appearance="fill"  class="w-100">
        <mat-label>Image URL</mat-label>
        <input matInput formControlName="imageUrl">
      </mat-form-field>

      <mat-form-field appearance="fill"  class="w-100">
        <mat-label>Keywords</mat-label>
        <input matInput formControlName="keywords">
      </mat-form-field>

      <div formGroupName="institution" class="w-100">
        <div class="block-title w-100">The Institution</div>
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name">
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Private or public</mat-label>
          <mat-select formControlName="isPrivate">
            <mat-option [value]="true">Private</mat-option>
            <mat-option [value]="false">Public</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Type of institution</mat-label>
          <mat-select formControlName="institutionType">
            <mat-option value="university">University</mat-option>
            <mat-option value="laboratory">Laboratory</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Location</mat-label>
          <input matInput formControlName="location">
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Website</mat-label>
          <input matInput formControlName="website">
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Department</mat-label>
          <input matInput formControlName="department">
        </mat-form-field>

        <mat-form-field appearance="fill"  class="w-100">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description"></textarea>
        </mat-form-field>
      </div>

      <div formGroupName="contactPerson" class="w-100">
        <div class="block-title w-100">Contact Person</div>
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name">
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Surname</mat-label>
          <input matInput formControlName="surname">
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" type="email">
        </mat-form-field>
      </div>

      <div formGroupName="data" class="w-100">
        <div class="block-title w-100">Data</div>
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>License</mat-label>
          <input matInput formControlName="license">
        </mat-form-field>

        <mat-form-field appearance="fill"  class="w-100">
          <mat-label>Third parties</mat-label>
          <textarea matInput formControlName="thirdParties"></textarea>
        </mat-form-field>

        <div class="select-file-block">
          <input type="file"
                 id="select-file"
                 hidden
                 (change)="uploadFile($event.target.files)"
          />
          <label for="select-file" class="select-file-label">Select file</label>
          <a [href]="call.fileUrl"
             *ngIf="this.call && this.call.data.dataTemplate; else noFile"
          >{{ fileName }}</a>
          <ng-template #noFile>No file chosen</ng-template>
        </div>

        <mat-form-field appearance="fill"  class="w-100">
          <mat-label>Does this data contain personal information?</mat-label>
          <textarea matInput formControlName="personalInformation"></textarea>
        </mat-form-field>
      </div>

      <mat-card-actions>
        <button mat-raised-button color="primary" type="submit">Submit</button>
      </mat-card-actions>
    </form>
  </mat-card-content>
</mat-card>

<ng-template #create>
  <mat-stepper [linear]="true" #stepper>
    <mat-step [stepControl]="generalForm" class="con-call-edit-wrapper">
      <div class="con-call-edit-wrapper">
        <form [formGroup]="generalForm" class="form stepper-form">
          <ng-template matStepLabel>Create a call</ng-template>

          <div class="block-title w-100">Basic Information</div>
          <mat-form-field appearance="fill" class="w-100">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title">
          </mat-form-field>

          <mat-form-field appearance="fill"  class="w-100">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description"></textarea>
          </mat-form-field>

          <mat-form-field appearance="fill"  class="w-100">
            <mat-label>Image URL</mat-label>
            <input matInput formControlName="imageUrl">
          </mat-form-field>

          <mat-form-field appearance="fill"  class="w-100">
            <mat-label>Keywords</mat-label>
            <input matInput formControlName="keywords">
          </mat-form-field>

          <div formGroupName="institution" class="w-100">
            <div class="block-title w-100">The Institution</div>
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name">
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Private or public</mat-label>
              <mat-select formControlName="isPrivate">
                <mat-option [value]="true">Private</mat-option>
                <mat-option [value]="false">Public</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Type of institution</mat-label>
              <mat-select formControlName="institutionType">
                <mat-option value="university">University</mat-option>
                <mat-option value="laboratory">Laboratory</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Location</mat-label>
              <input matInput formControlName="location">
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Website</mat-label>
              <input matInput formControlName="website">
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Department</mat-label>
              <input matInput formControlName="department">
            </mat-form-field>

            <mat-form-field appearance="fill"  class="w-100">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description"></textarea>
            </mat-form-field>
          </div>

          <div formGroupName="contactPerson" class="w-100">
            <div class="block-title w-100">Contact Person</div>
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name">
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Surname</mat-label>
              <input matInput formControlName="surname">
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email">
            </mat-form-field>
          </div>

          <div formGroupName="data" class="w-100">
            <div class="block-title w-100">Data</div>
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>License</mat-label>
              <input matInput formControlName="license">
            </mat-form-field>

            <mat-form-field appearance="fill"  class="w-100">
              <mat-label>Third parties</mat-label>
              <textarea matInput formControlName="thirdParties"></textarea>
            </mat-form-field>

            <mat-form-field appearance="fill"  class="w-100">
              <mat-label>Does this data contain personal information?</mat-label>
              <textarea matInput formControlName="personalInformation"></textarea>
            </mat-form-field>
          </div>

          <div class="navigation-buttons">
            <button mat-raised-button
                    color="primary"
                    matStepperNext
                    (click)="submitForm()"
                    [disabled]="generalForm.invalid"
            >Next</button>
          </div>
        </form>
      </div>
    </mat-step>
    <mat-step [stepControl]="fileForm" label="Upload template">
      <div class="con-call-edit-wrapper">
        <div class="select-file-block">
          <input type="file"
                id="select-file"
                hidden
                (change)="uploadFile($event.target.files)"
          />
          <label for="select-file" class="select-file-label">Select file</label>
          <a [href]="cfdService.currentCall.fileUrl"
              *ngIf="cfdService.currentCall && cfdService.currentCall.fileUrl; else noFile"
          >{{ fileName }}</a>
          <ng-template #noFile>No file chosen</ng-template>
        </div>
        <div class="navigation-buttons">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" matStepperNext>Next</button>
        </div>
      </div>
    </mat-step>
    <mat-step label="Done">
      <div class="done-step">
        <div>You created call for data "{{cfdService.currentCall?.title}}"</div>
        <button mat-raised-button
                color="primary"
                (click)="finish()"
        >Go to all calls</button>
      </div>
    </mat-step>
  </mat-stepper>
</ng-template>
